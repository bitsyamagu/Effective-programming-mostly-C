# Standards (標準)に準拠する

## UNIXとシステムコール
C言語はUNIXのOSと共に登場し、UNIXと共に普及してきました。UNIXとC言語の登場以前は
計算機ベンダーごとにOSの機能はばらばらで、プログラムの移植性はほぼ無いに等しかったので、
別のベンダの計算機に買い替えたら今まで使っていたプログラムは全部書き直さなければなりませんでしたし、
同一のベンダであっても後継機になれば書き直しが必要でした。

そこで、UNIXではOSのカーネルに対して何か要求する場合、例えばファイルを作る、プロセスを分岐する、ユーザIDを切り替えるなどのOSの機能を呼び出す場合は*システムコール*と呼ばれる関数群を通じて呼び出すこととし、どのベンダのUNIXであってもこのシステムコールの振る舞いは同じであるという規約を設けました。

つまりUNIXというのは実装はHPやSun、IBMなどで各社色々なのですが、システムコールという関数のセットは共通で、そのシステムコールを使ってプログラムを書けば、どのベンダのUNIXマシンを買ってもこれまで使っていたプログラムは再コンパイルするだけで利用し続けられるようになったのです。ベンダによってCPUも違えばディスク装置などの記憶装置も違うなどハードウェアの実装や、それを制御するデバイスドライバ、OSのカーネルも実装は違うのですが、システムコールに対しては統一した振る舞いをするように定められているので、システムコールの関数群のみを使ってプログラムを書いている限りは移植性が約束されたのです。

UNIXはベル研究所で開発されたものですが、UNIXはベル研究所の母体であるAT&Tから各社にライセンスする形で、実機はHP(HP-UX)やSunマイクロシステムズ(Sun OS, Solaris)、Silicon Graphics社(Iris)、IBM(AIX)などが製造、販売していました。

下記のURLは現在のシステムコールの一覧ですが、Linux等ではコマンドラインではman syscallsを実行することで、今でもシステムコール一覧をいつでも表示させることができます。

システムコール一覧
https://linuxjm.osdn.jp/html/LDP_man-pages/man2/syscalls.2.html

## MS-WindowsやAppleなどの非UNIX系OSの普及
UNIXは1970年代に登場しましたが、当時の計算機の主流はまだUNIXのようなものではなく、
ビジネス用途ではIBMを中心とした大型計算機などでした。1980年代後半になると
MS-DOSやAppleのMacなどが登場してきます。

C言語はUNIX用に開発されたプログラミング言語でしたが、その頃には様々なOS用に
コンパイラが販売されるようになり、そこではまた移植性が問題になり始めました。
当時のC言語の手本とされていたのはK&RのCと呼ばれる開発者のリッチーと
カーニハンの書籍で紹介されたC言語でしたが、これには何らの拘束力もないので、
C言語には各社独自の拡張や非標準の関数などが加えられていたり、
逆に機能が不十分な処理系、誤った動作をする処理系もありました。

この頃に米国規格協会が策定したC言語の標準がANSI-Cと呼ばれるもので、これによって初めて
C言語の言語仕様はK&Rの単なる書籍から明文化された工業規格になりました。当時コンパイラを作っていた
MicrosoftやBorlandなどのソフトウェア開発企業は仕様への準拠を進めていき、
C言語はUNIXだけでなくパソコン用OSでも移植性が実現されるようになっていきました。

ANSI-Cの標準化の流れは、現在ではISOに引き継がれ、国際規格としてC90、C95、
C99、C11、C17と発展を続けています。

一方、ANSI-Cに取り込まれなかったUNIXのOS特有の機能は、UNIX-likeなシステムの
国際規格としてPOSIXという規格にまとめられ、こちらについてもMS-Windows、
MacOS、 Linuxなどの主要なOSで準拠が進められています。また、ISO-CとPOSIXは
重なる部分もあり、それらの規格でカバーされる関数群を使用してプログラムを書いている限りは、
高い移植性が確保できます。

## なぜそこまで移植性にこだわるのか

日本語では「移植性」という用語ですが、英語では「Portability」です。
Portabilityの意味としては「可搬性」の方が近いかもしれません。

一つのソフトウェアのシステムを他のプラットホームに移植できる、ということ以上に、
以下のようなメリットがあります。
1. 再利用性の向上
   - プログラムを部品のように構築しておき、多数のソフトウェア部品を組み合わせてシステムを構築できます
2. 時間軸での再利用性の向上（長寿命化）
   - 計算機のハードウェアの寿命は5年ほどでしかなく、時間の経過とともにOSの機能も更新されていきますが、OSや処理系側が明文化されたISO-CやPOSIXに準拠していれば使い続けられます。
     - RやPythonでは裏切られることがありますが
3. 他社ハードウェアへの乗り換え
   - 乗り換え先のOSや開発環境がISO-CやPOSIXの仕様に準拠していれば、安いハードウェアに乗り換えたり、より高性能なハードウェアへの乗り換えも可能です。またベンダロックインを予防できます。
4. 教育
    - 統一した内容で教育すればベンダ依存の知識は不要で、どのようなプラットホームの仕事でも対応することができます。
5. 可読性、性能の向上
    - PythonやRのようなプログラミング言語では、標準APIがあってもカバーされる範囲が狭かったり、プログラマが不勉強だったりするために独自の関数などで実装してしまうことがありますが、標準化された
    関数の方が本来は使い慣れている人が多く、可読性が上がります。また、経験豊富な開発者達が作った
    標準APIのライブラリよりも高性能なものを作るのは容易ではありません。
6. 保守性
   - 標準といっても、セキュリティ上の理由などで数年後に変更を迫られる場合もあります。標準化されたAPIや言語仕様は利用者数も多いので、移行に必要な情報が提供され、移行期限も示されるでしょう。突然動かなくなるような事態は回避できます。

